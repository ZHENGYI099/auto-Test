# Auto-Test V2 桌面客户端使用指南

## 🚀 快速启动

### 方法 1: 使用启动脚本（推荐）
双击 `启动测试客户端.bat` 文件

### 方法 2: 命令行启动
```bash
cd d:\auto-Test\auto-test-v2
python gui_client.py
```

## 📋 功能特性

### 1. **CSV 文件上传**
   - 支持选择本地 CSV 测试文件
   - 自动识别测试用例 ID
   - 可手动修改测试用例 ID

### 2. **自动生成测试脚本**
   - 基于 AI (Azure OpenAI GPT-4) 自动生成 PowerShell 脚本
   - 支持脚本优化和精炼
   - 实时显示生成进度

### 3. **测试执行**
   - 以管理员权限执行测试脚本
   - 实时显示测试状态
   - 支持中途停止测试

### 4. **结果展示**
   - 实时输出日志
   - 自动统计通过/失败数量
   - 彩色标记不同状态（成功/失败/警告）
   - 支持查看详细测试结果文件

### 5. **辅助功能**
   - 一键打开输出目录
   - 清除日志
   - 保存测试历史

## 🎯 使用流程

### Step 1: 选择 CSV 文件
1. 点击 **[选择文件...]** 按钮
2. 选择你的 CSV 测试文件（例如: `case2test.csv`）
3. 系统会自动提取测试用例 ID，也可以手动修改

### Step 2: 生成测试脚本
1. 点击 **[📝 生成测试脚本]** 按钮
2. 等待 AI 生成脚本（通常需要 10-30 秒）
3. 查看日志输出，确认生成成功
4. 生成的脚本会保存到 `output/` 目录

### Step 3: 执行测试
1. 点击 **[▶️ 执行测试（管理员）]** 按钮
2. 系统会弹出 UAC 提示，点击"是"授予管理员权限
3. PowerShell 窗口会弹出并显示实时测试进度
4. 等待测试完成，查看结果摘要

### Step 4: 查看结果
- 在日志区域查看测试摘要（通过/失败数量）
- 点击 **[📂 打开输出目录]** 查看详细结果文件
- 结果文件格式: `{test_case_id}_*_VerifyResult.json`

## 🎨 界面说明

```
┌──────────────────────────────────────────────────────┐
│  📋 Auto-Test V2                                     │
│  自动化测试脚本生成与执行工具                          │
├──────────────────────────────────────────────────────┤
│  🗂️ 步骤 1: 选择 CSV 测试文件                        │
│  CSV 文件: [___________________________] [选择文件...] │
│  测试用例 ID: [_______________] (可选)                │
├──────────────────────────────────────────────────────┤
│  ⚙️ 步骤 2: 生成并执行测试                            │
│  [📝 生成测试脚本] [▶️ 执行测试] [⏹️ 停止] [📂 打开目录] │
│  状态: 就绪                                           │
│  进度: [████████████████████████] 100%                │
├──────────────────────────────────────────────────────┤
│  📊 实时输出日志                                      │
│  ┌────────────────────────────────────────────────┐  │
│  │ [12:34:56] ✅ 测试脚本生成完成!                 │  │
│  │ [12:35:10] 🚀 启动测试执行...                   │  │
│  │ [12:35:45] ✅ 通过: 12                          │  │
│  │ [12:35:45] ❌ 失败: 1                           │  │
│  └────────────────────────────────────────────────┘  │
│                                       [清除日志]      │
└──────────────────────────────────────────────────────┘
```

## 🎨 日志颜色说明

- 🔵 **蓝色**: 普通信息
- 🟢 **绿色**: 成功消息
- 🔴 **红色**: 错误消息
- 🟠 **橙色**: 警告消息
- **绿色粗体**: 测试通过 (PASS)
- **红色粗体**: 测试失败 (FAIL)

## ⚙️ 配置要求

### 必需
- Python 3.8+
- Windows 10/11
- 必要的 Python 包（见 `requirements.txt`）
- Azure OpenAI 访问权限

### 依赖安装
```bash
pip install -r requirements.txt
```

主要依赖:
- `tkinter` - GUI 界面（Python 自带）
- `openai` - Azure OpenAI 客户端
- `pydantic` - 数据验证
- `python-dotenv` - 环境变量管理

## 🔧 高级选项

### 命令行参数（如需要）
如果你想在命令行中使用传统方式，仍然可以使用:

```bash
# 生成脚本
python run.py --csv input/case2test.csv -o output/test_case2test.ps1 --keep-json --no-refine

# 执行脚本（管理员权限）
Start-Process powershell -ArgumentList "-NoProfile","-ExecutionPolicy","Bypass","-File","d:\auto-Test\auto-test-v2\output\test_case2test.ps1" -Verb RunAs
```

但桌面客户端已经集成了这些功能，更方便使用。

## 📁 目录结构

```
auto-test-v2/
├── gui_client.py              # 桌面客户端主程序 ⭐
├── 启动测试客户端.bat          # 快速启动脚本 ⭐
├── run.py                     # 命令行版本（保留）
├── input/                     # CSV 文件存放目录
│   └── *.csv
├── output/                    # 生成的脚本和结果
│   ├── *.ps1                  # PowerShell 测试脚本
│   └── *_VerifyResult.json    # 测试结果文件
├── core/                      # 核心逻辑模块
├── agents/                    # AI Agent 模块
└── config/                    # 配置文件
```

## ❓ 常见问题

### Q1: 启动时提示找不到模块？
**A:** 请确保已安装所有依赖:
```bash
pip install -r requirements.txt
```

### Q2: 测试执行时没有弹出 PowerShell 窗口？
**A:** 可能是 UAC 权限问题，请确保：
1. 以管理员身份运行客户端
2. 或在 UAC 提示时点击"是"

### Q3: 生成脚本很慢？
**A:** 这是正常的，因为需要调用 Azure OpenAI API 进行 AI 生成，通常需要 10-30 秒。

### Q4: 如何查看详细测试结果？
**A:** 点击 **[📂 打开输出目录]** 按钮，找到对应的 `*_VerifyResult.json` 文件。

### Q5: 可以同时运行多个测试吗？
**A:** 目前不支持，建议等待当前测试完成后再运行下一个。

## 🆚 命令行 vs 桌面客户端

| 特性 | 命令行版本 | 桌面客户端 |
|------|-----------|-----------|
| CSV 文件选择 | 手动输入路径 | ✅ 图形化选择 |
| 实时进度显示 | ❌ 基本输出 | ✅ 进度条+彩色日志 |
| 测试执行 | 需要手动运行 | ✅ 一键执行 |
| 结果查看 | 需要打开文件 | ✅ 自动统计摘要 |
| 用户友好度 | ⭐⭐ | ⭐⭐⭐⭐⭐ |

## 📞 技术支持

如有问题，请检查:
1. 日志输出中的错误信息
2. `output/` 目录中的脚本文件
3. Azure OpenAI 配置是否正确

## 🔄 更新日志

### v2.0 (2025-10-23)
- ✨ 新增桌面 GUI 客户端
- ✨ 支持 CSV 文件图形化选择
- ✨ 实时显示测试进度和状态
- ✨ 彩色日志输出
- ✨ 自动测试结果统计
- ✨ 一键管理员权限执行

### v1.0
- 基础命令行功能
- CSV 转 JSON
- AI 脚本生成

---

**享受自动化测试的乐趣！** 🎉
