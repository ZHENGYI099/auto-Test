{
  "test_case_id": "testcase-34714753",
  "generated_at": "2025-10-15T07:26:24Z",
  "model_deployment": "gpt-4.1",
  "steps": [
    {
      "step": 1,
      "action": "Apply to all devices.",
      "expected": "",
      "action_script": "",
      "verify_script": null,
      "need_vision_verify": false
    },
    {
      "step": 2,
      "action": "Press \"Win + E\" keys, open File Explorer, go to the folder where \"cmdextension.msi\" locates,cmdextension.msi locates in C:\\VMShare",
      "expected": "",
      "action_script": "Set-Location -LiteralPath 'C:\\VMShare'",
      "verify_script": null,
      "need_vision_verify": false
    },
    {
      "step": 3,
      "action": "Verify administrator privileges (script already running as admin)",
      "expected": "Script is running with Administrator privileges, ready for MSI installation",
      "action_script": "$isAdmin=([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator); if ($isAdmin) {Write-Host 'Running as Administrator'} else {Write-Host 'WARNING: Not running as Administrator'}",
      "verify_script": "$isAdmin=([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator); if ($isAdmin) {exit 0} else {exit 1}",
      "need_vision_verify": false
    },
    {
      "step": 4,
      "action": "Run command: msiexec /i cmdextension.msi /qn (silent installation)",
      "expected": "MSI installation completes successfully with exit code 0 or 3010. Service 'CloudManagedDesktopExtension' should be created and running. Installation success verified by subsequent service checks in Steps 5-7.",
      "action_script": "$msiPath='C:\\VMShare\\cmdextension.msi'; $msiLogPath=\"$PSScriptRoot\\outputs\\msi_install_$(Get-Date -Format 'yyyyMMddHHmmss').log\"; $process=Start-Process -FilePath 'msiexec.exe' -ArgumentList '/i',\"`\"$msiPath`\"\",'/qn','/l*v',\"`\"$msiLogPath`\"\" -Wait -PassThru -NoNewWindow; $exitCode=$process.ExitCode; if ($exitCode -eq 0 -or $exitCode -eq 3010) {Write-Host \"Installation successful (exit code: $exitCode)\"} else {Write-Host \"Installation completed with exit code: $exitCode. Check log: $msiLogPath\"}",
      "verify_script": "$svc=Get-Service -Name 'CloudManagedDesktopExtension' -ErrorAction SilentlyContinue; if ($svc) {exit 0} else {exit 1}",
      "need_vision_verify": false
    },
    {
      "step": 5,
      "action": "Open \"Control Panel -> Programs -> Uninstall a program\"",
      "expected": "Verify \"Microsoft Cloud Managed Desktop Extension\" is present in the list of installed programs.",
      "action_script": "",
      "verify_script": "if (Get-ItemProperty 'HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*','HKLM:\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*','HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*' | Where-Object {$_.DisplayName -like '*Microsoft Cloud Managed Desktop Extension*'}) {exit 0} else {exit 1}",
      "need_vision_verify": false
    },
    {
      "step": 6,
      "action": "Open \"Task Manager -> Services\"",
      "expected": "Verify \"CloudManagedDesktopExtension\"\nis in running state.",
      "action_script": "",
      "verify_script": "$svc=Get-Service -Name 'CloudManagedDesktopExtension' -ErrorAction SilentlyContinue; if ($svc -and $svc.Status -eq 'Running') {exit 0} else {exit 1}",
      "need_vision_verify": false
    },
    {
      "step": 7,
      "action": "Press \"Win + R\" keys, type \"services.msc\" and press Enter.",
      "expected": "Verify \"Microsoft Cloud Managed Desktop Extension\" - Status is \"Running\", Startup Type is \"Automatic (Delayed Start)\", and Log On As is \"Local System\".",
      "action_script": "",
      "verify_script": "$s=Get-WmiObject -Class Win32_Service -Filter \"Name='CloudManagedDesktopExtension'\"; if ($s -and $s.State -eq 'Running' -and $s.StartMode -eq 'Auto' -and $s.StartName -eq 'LocalSystem') {exit 0} else {exit 1}",
      "need_vision_verify": false
    },
    {
      "step": 8,
      "action": "Verify log file exists in %ProgramData%\\Microsoft\\CMDExtension\\Logs",
      "expected": "CMDExtension.log file is present with valid content",
      "action_script": "",
      "verify_script": "$logPath=\"$env:ProgramData\\Microsoft\\CMDExtension\\Logs\\CMDExtension.log\"; if (Test-Path $logPath) {$fileInfo=Get-Item $logPath; Write-Host \"Log file found: Size=$($fileInfo.Length) bytes\"; exit 0} else {exit 1}",
      "need_vision_verify": false
    },
    {
      "step": 9,
      "action": "Press \"Win + R\" keys, type \"taskschd.msc\" and press Enter. Open \"Task scheduler library -> Microsoft -> CMD\"",
      "expected": "Verify \"Cloud Managed Desktop Extension Health Evaluation\" is present.",
      "action_script": "",
      "verify_script": "$task = Get-ScheduledTask -TaskName 'Cloud Managed Desktop Extension Health Evaluation' -ErrorAction SilentlyContinue; if ($task) {exit 0} else {exit 1}",
      "need_vision_verify": false
    },
    {
      "step": 10,
      "action": "Press \"Win + R\" keys, type \"wbemtest\" and press Enter. Click on \"Connect\", type \"root\\cmd\\clientagent\" and press Enter.",
      "expected": "Verify there is NOT error prompt window which displays \"Invalid namespace\".",
      "action_script": "",
      "verify_script": "if ((Get-WmiObject -Namespace 'root\\cmd\\clientagent' -List -ErrorAction SilentlyContinue)) {exit 0} else {exit 1}",
      "need_vision_verify": false
    },
    {
      "step": 11,
      "action": "Test Cleanup: Run command: msiexec /x cmdextension.msi /qn (silent uninstallation)",
      "expected": "MSI uninstallation completes silently. Exit code 0 or 3010 indicates success. Service 'CloudManagedDesktopExtension' should be removed.",
      "action_script": "$msiPath='C:\\VMShare\\cmdextension.msi'; $uninstallLogPath=\"$PSScriptRoot\\outputs\\msi_uninstall_$(Get-Date -Format 'yyyyMMddHHmmss').log\"; $process=Start-Process -FilePath 'msiexec.exe' -ArgumentList '/x',\"`\"$msiPath`\"\",'/qn','/l*v',\"`\"$uninstallLogPath`\"\" -Wait -PassThru -NoNewWindow; $exitCode=$process.ExitCode; if ($exitCode -eq 0 -or $exitCode -eq 3010 -or $exitCode -eq 1605) {Write-Host \"Uninstallation successful (exit code: $exitCode)\"} else {Write-Host \"Uninstallation completed with exit code: $exitCode. Check log: $uninstallLogPath\"}",
      "verify_script": "$svc=Get-Service -Name 'CloudManagedDesktopExtension' -ErrorAction SilentlyContinue; if (!$svc) {exit 0} else {exit 1}",
      "need_vision_verify": false
    }
  ]
}